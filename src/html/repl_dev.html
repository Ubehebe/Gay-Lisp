<!DOCTYPE html>
<html>
<head>
    <title>Gay Lisp</title>
    <link rel="stylesheet" href="../css/repl.css" />
    <script src="../js/globals.js"></script>
    <script src="../js/timer.js"></script>
    <script src="../js/rename_helper.js"></script>
    <script src="../js/root_environment.js"></script>
    <script src="../js/port.js"></script>
    <script src="../js/callback_backed_port.js"></script>
    <script src="../js/node_backed_port.js"></script>
    <script src="../js/datum.js"></script>
    <script src="../js/environment.js"></script>
    <script src="../js/scheme_procedure.js"></script>
    <script src="../js/errors.js"></script>
    <script src="../js/scanner.js"></script>
    <script src="../js/parse.js"></script>
    <script src="../js/output_modes.js"></script>
    <script src="../js/read.js"></script>
    <script src="../js/scheme_macro.js"></script>
    <script src="../js/transformer.js"></script>
    <script src="../js/list_like_transformer.js"></script>
    <script src="../js/ellipsis_transformer.js"></script>
    <script src="../js/id_or_literal_transformer.js"></script>
    <script src="../js/template_bindings.js"></script>
    <script src="../js/continuation.js"></script>
    <script src="../js/continuable.js"></script>
    <script src="../js/continuable_helper.js"></script>
    <script src="../js/branch.js"></script>
    <script src="../js/env_buffer.js"></script>
    <script src="../js/proc_call.js"></script>
    <script src="../js/sibling_buffer.js"></script>
    <script src="../js/trampoline_helper.js"></script>
    <script src="../js/trampoline.js"></script>
    <script src="../js/cdr_helper.js"></script>
    <script src="../js/stdproc.js"></script>
    <script src="../js/unit_test.js"></script>
    <script src="../js/pipeline.js"></script>
    <script src="../js/boot.js"></script>
    <script src="../js/lazy_boot.js"></script>
    <script src="../../mockterm/mockterm.js"></script>
    <script src="../../tutorial/tutorial.js"></script>
    <script type="text/javascript">
        /* Set up the syntax and procedures vars so that the bootstrap call
         in api.js works. */

        /* This synchronous ajax stuff is just for development.
         In production, the Scheme syntax and procedure libraries are embedded
         as string literals into the big JavaScript file. */
        function ajaxSync(url, callback) {
            var req = new XMLHttpRequest();
            req.open('GET', url, false /* synchronous */);
            req.onreadystatechange = function () {
                if (req.readyState === 4 && req.status === 200)
                    callback(req.responseText);
            };
            req.send();
        }

        var syntax, procedures;

        ajaxSync('../scm/r5rs-syntax.scm', function (syntaxLib) {
            ajaxSync('../scm/r5rs-procedures.scm', function (procLib) {
                syntax = syntaxLib;
                procedures = procLib;
            });
        });
    </script>
    <script src="../api/api.js"></script>
    <script>
        addEventListener('load', function () {
            var terminal = new MockTerminal(document.getElementById('repl'))
                    .setPrompt('>> ')
                    .setInterpreter(function(string) {
                        if (string === '(tutorial)') {
                            terminal.reset();
                            terminal.print(tutorial.getIntroMessage());
                            terminal.setInterpreter(function(string) {
                                return tutorial.eval(string);
                            });
                            return '';
                        } else {
                            return GayLisp.repl(string, function(sideEffect) {
                                terminal.print('\n' + sideEffect);
                            });
                        }
                    })
                    .setInputCompleteHandler(GayLisp.willParse)
                    .start();
        });
    </script>
</head>
<body>
<textarea class='terminal' id='repl' rows=15 cols=80 autofocus spellcheck="false"></textarea>
</body>
</html>